"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[50345],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var r=n(67294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n,r,s={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,s=e.mdxType,o=e.originalType,l=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),m=u(n),d=s,f=m["".concat(l,".").concat(d)]||m[d]||p[d]||o;return n?r.createElement(f,i(i({ref:t},c),{},{components:n})):r.createElement(f,i({ref:t},c))}));function d(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var o=n.length,i=new Array(o);i[0]=m;var a={};for(var l in t)hasOwnProperty.call(t,l)&&(a[l]=t[l]);a.originalType=e,a.mdxType="string"==typeof e?e:s,i[1]=a;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},21062:function(e,t,n){n.r(t),n.d(t,{assets:function(){return h},contentTitle:function(){return d},default:function(){return b},frontMatter:function(){return m},metadata:function(){return f},toc:function(){return v}});var r=n(3905),s=Object.defineProperty,o=Object.defineProperties,i=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,c=(e,t,n)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,p=(e,t)=>{for(var n in t||(t={}))l.call(t,n)&&c(e,n,t[n]);if(a)for(var n of a(t))u.call(t,n)&&c(e,n,t[n]);return e};const m={},d="Unit tests",f={unversionedId:"manual/development/unit-tests",id:"manual/development/unit-tests",title:"Unit tests",description:"We unit test our common library, while it isn't near complete coverage but it does offer some basic checks.",source:"@site/docs/manual/development/unit-tests.md",sourceDirName:"manual/development",slug:"/manual/development/unit-tests",permalink:"/docs/manual/development/unit-tests",draft:!1,editUrl:"https://github.com/truecharts/website/tree/master/docs/manual/development/unit-tests.md",tags:[],version:"current",frontMatter:{},sidebar:"manualSidebar",previous:{title:"Storage",permalink:"/docs/manual/development/storage"},next:{title:"Values.yaml Files",permalink:"/docs/manual/development/values-yaml"}},h={},v=[{value:"Running the tests",id:"running-the-tests",level:2},{value:"Using Visual Studio Code",id:"using-visual-studio-code",level:3},{value:"Prerequisites",id:"prerequisites",level:4},{value:"Running tests",id:"running-tests",level:4},{value:"Output",id:"output",level:2}],g={toc:v};function b(e){var t,n=e,{components:s}=n,c=((e,t)=>{var n={};for(var r in e)l.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&a)for(var r of a(e))t.indexOf(r)<0&&u.call(e,r)&&(n[r]=e[r]);return n})(n,["components"]);return(0,r.kt)("wrapper",(t=p(p({},g),c),o(t,i({components:s,mdxType:"MDXLayout"}))),(0,r.kt)("h1",p({},{id:"unit-tests"}),"Unit tests"),(0,r.kt)("p",null,"We unit test our common library, while it isn't near complete coverage but it does offer some basic checks."),(0,r.kt)("h2",p({},{id:"running-the-tests"}),"Running the tests"),(0,r.kt)("p",null,"Running these tests can be done any way you like. In this document we limit ourselves to using Visual Studio Code, using our Development Container."),(0,r.kt)("h3",p({},{id:"using-visual-studio-code"}),"Using Visual Studio Code"),(0,r.kt)("p",null,"Our repo comes with a Visual Studio Code ",(0,r.kt)("a",p({parentName:"p"},{href:"https://code.visualstudio.com/docs/remote/containers"}),"development container")," definition and ",(0,r.kt)("inlineCode",{parentName:"p"},"launch.json")," that allow you to quickly set up an environment in which you can run the tests."),(0,r.kt)("h4",p({},{id:"prerequisites"}),"Prerequisites"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Visual Studio Code is installed."),(0,r.kt)("li",{parentName:"ul"},"Docker is installed and running."),(0,r.kt)("li",{parentName:"ul"},'The "Remote - Containers" extension is installed and enabled in Visual Studio Code.')),(0,r.kt)("p",null,"For more details, please refer to the ",(0,r.kt)("a",p({parentName:"p"},{href:"https://code.visualstudio.com/docs/remote/containers#_system-requirements"}),"official documentation"),"."),(0,r.kt)("h4",p({},{id:"running-tests"}),"Running tests"),(0,r.kt)("p",null,"Once Visual Studio Code is set up, and you open the ",(0,r.kt)("inlineCode",{parentName:"p"},"charts")," workspace, you will see a popup asking if you wish to re-open the workspace in a development container:"),(0,r.kt)("p",null,(0,r.kt)("img",p({parentName:"p"},{src:"https://raw.githubusercontent.com/k8s-at-home/charts/master/docs/images/vscode_devcontainer_popup.png",alt:"Visual Studio Code development container popup"}))),(0,r.kt)("p",null,"Select to do so and a Dockerized workspace will be built. You can now use Visual Studio Code as normal."),(0,r.kt)("p",null,'To run or debug the unit tests, click the "Run" button on the left sidebar and select the desired configuration:'),(0,r.kt)("p",null,(0,r.kt)("img",p({parentName:"p"},{src:"https://raw.githubusercontent.com/k8s-at-home/charts/master/docs/images/vscode_run_unittests.png",alt:"Visual Studio Code run configurations"}))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"UnitTest - active spec file only"),": This configuration will try to run the currently opened test file."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Note:")," Make sure that you have opened a valid test file (",(0,r.kt)("inlineCode",{parentName:"p"},".rb")," files in the ",(0,r.kt)("inlineCode",{parentName:"p"},"test/charts")," folder), or this will not work.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("em",{parentName:"p"},"UnitTest - all spec files"),": This configuration will run the all test files in the ",(0,r.kt)("inlineCode",{parentName:"p"},"test/charts")," folder."))),(0,r.kt)("p",null,'Next, press the green "Play" icon. This will start the tests show the outcome in a terminal window.'),(0,r.kt)("h2",p({},{id:"output"}),"Output"),(0,r.kt)("p",null,"A successful test will output something like the following..."),(0,r.kt)("pre",null,(0,r.kt)("code",p({parentName:"pre"},{className:"language-text"}),'Started with run options --seed 52955\n\ncommon-test::statefulset volumeClaimTemplates\n  can set values for volumeClaimTemplates                         PASS (0.16s)\n  volumeClaimTemplates should be empty by default                 PASS (0.06s)\n\ncommon-test::ports settings\n  targetPort can be overridden                                    PASS (0.17s)\n  port name can be overridden                                     PASS (0.17s)\n  defaults to name "http" on port 8080                            PASS (0.16s)\n  targetPort cannot be a named port                               PASS (0.05s)\n\ncommon-test::pod replicas\n  defaults to 1                                                   PASS (0.08s)\n  accepts integer as value                                        PASS (0.08s)\n\ncommon-test::Environment settings\n  Check no environment variables                                  PASS (0.05s)\n  set "valueFrom" environment variables                           PASS (0.11s)\n  set "static" and "Dynamic/Tpl" environment variables            PASS (0.15s)\n  set "Dynamic/Tpl" environment variables                         PASS (0.11s)\n  set "static" environment variables                              PASS (0.10s)\n\ncommon-test::ingress\n  ingress with hosts                                              PASS (0.10s)\n  should be disabled when ingress.enabled: false                  PASS (0.06s)\n  ingress with hosts template is evaluated                        PASS (0.11s)\n  ingress with hosts and tls                                      PASS (0.15s)\n  ingress with hosts and tls templates is evaluated               PASS (0.16s)\n  should be enabled when ingress.enabled: true                    PASS (0.06s)\n\ncommon-test::controller type\n  accepts "daemonset"                                             PASS (0.06s)\n  accepts "statefulset"                                           PASS (0.06s)\n  defaults to "Deployment"                                        PASS (0.06s)\n\nFinished in 2.26077s\n22 tests, 59 assertions, 0 failures, 0 errors, 0 skips\n')))}b.isMDXComponent=!0}}]);