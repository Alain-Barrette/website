"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[11353],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return d}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),k=u(n),d=r,m=k["".concat(s,".").concat(d)]||k[d]||c[d]||i;return n?a.createElement(m,o(o({ref:t},p),{},{components:n})):a.createElement(m,o({ref:t},p))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=k;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var u=2;u<i;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}k.displayName="MDXCreateElement"},52258:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return d},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return c}});var a=n(83117),r=n(80102),i=(n(67294),n(3905)),o=["components"],l={},s="14 - Backup and Restore",u={unversionedId:"manual/SCALE Apps/Quick-Start Guides/backup-restore",id:"manual/SCALE Apps/Quick-Start Guides/backup-restore",title:"14 - Backup and Restore",description:"Requirements",source:"@site/docs/manual/SCALE Apps/Quick-Start Guides/14-backup-restore.md",sourceDirName:"manual/SCALE Apps/Quick-Start Guides",slug:"/manual/SCALE Apps/Quick-Start Guides/backup-restore",permalink:"/docs/manual/SCALE Apps/Quick-Start Guides/backup-restore",draft:!1,editUrl:"https://github.com/truecharts/pub/docs/manual/SCALE Apps/Quick-Start Guides/14-backup-restore.md",tags:[],version:"current",sidebarPosition:14,frontMatter:{},sidebar:"manualSidebar",previous:{title:"13 - Docker-Compose on SCALE",permalink:"/docs/manual/SCALE Apps/Quick-Start Guides/docker-compose"},next:{title:"15 - Accessing PVC Data",permalink:"/docs/manual/SCALE Apps/Quick-Start Guides/pvc-access"}},p={},c=[{value:"Requirements",id:"requirements",level:2},{value:"Backup",id:"backup",level:2},{value:"Creating Manual Backups",id:"creating-manual-backups",level:5},{value:"Creating Frequent Backups",id:"creating-frequent-backups",level:5},{value:"Exporting Backups",id:"exporting-backups",level:5},{value:"Checking Backups",id:"checking-backups",level:5},{value:"Restore",id:"restore",level:2},{value:"Reverting a running system",id:"reverting-a-running-system",level:5},{value:"Total System restore",id:"total-system-restore",level:5},{value:"Video Guide",id:"video-guide",level:4},{value:"Additional Documentation",id:"additional-documentation",level:5}],k={toc:c};function d(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},k,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"14---backup-and-restore"},"14 - Backup and Restore"),(0,i.kt)("h2",{id:"requirements"},"Requirements"),(0,i.kt)("p",null,"This guide makes use of our command-line tool, called ",(0,i.kt)("inlineCode",{parentName:"p"},"TrueTool"),"."),(0,i.kt)("p",null,"This should be installed by using:\n",(0,i.kt)("inlineCode",{parentName:"p"},"pip install truetool")),(0,i.kt)("p",null,"Please be aware this needs reinstalling after each TrueNAS SCALE update."),(0,i.kt)("h2",{id:"backup"},"Backup"),(0,i.kt)("h5",{id:"creating-manual-backups"},"Creating Manual Backups"),(0,i.kt)("p",null,"Manual backups can easily be made using TrueTool."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"truetool -b")),(0,i.kt)("p",null,"It automatically deletes excessive backups, which defaults to a max. of 14 backups.\nTo increase this, to 31 for example, use:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"truetool -b 31")),(0,i.kt)("p",null,"This can also easily be combined with TrueTool update, sync, prune etc. like this:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"truetool -b 31 -u -s -p")),(0,i.kt)("p",null,"To find out which backups are made previously, you can run the following command:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"truetool -l")),(0,i.kt)("h5",{id:"creating-frequent-backups"},"Creating Frequent Backups"),(0,i.kt)("p",null,"SCALE includes an integrated system to backup the kubernetes objects as well as make snapshots of the ",(0,i.kt)("inlineCode",{parentName:"p"},"PVC")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"ix_volume")," storage.\nHowever, it does NOT create these outside of SCALE upgrades."),(0,i.kt)("p",null,"To create daily backups of the kubernetes objects, create a Cron Job in the SCALE UI with the TrueTool command you want to run.\nIf you want to ensure TrueTool automatically gets updated and/or (re)installed after a TrueNAS SCALE update, you can use:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"pip install --no-cache-dir --upgrade truetool && truetool -b -s -u -a -p")),(0,i.kt)("h5",{id:"exporting-backups"},"Exporting Backups"),(0,i.kt)("p",null,"The above only creates only a backup of the kubernetes objects and a snapshot of the ",(0,i.kt)("inlineCode",{parentName:"p"},"PVC")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"ix_volume")," storage.\nThese backups are saved under the same ix_applications dataset."),(0,i.kt)("p",null,"It does not protect these against, for example, deletion of datasets or save them on an external system."),(0,i.kt)("p",null,"We ",(0,i.kt)("strong",{parentName:"p"},"highly")," advice making both an internal backup (separate dataset on the same system) ",(0,i.kt)("em",{parentName:"p"},"and")," an offsite backup.\nOne could create a normal recursive(!) replication of the ",(0,i.kt)("inlineCode",{parentName:"p"},"ix-volumes")," dataset using the SCALE GUI, with the following few special tricks by editing the replication after creation:"),(0,i.kt)("p",null,"To do so, setup the following replication task:"),(0,i.kt)("a",{href:"/img/backup/rep1.png"},(0,i.kt)("img",{src:"/img/backup/rep1.png",width:"100%"})),(0,i.kt)("a",{href:"/img/backup/rep2.png"},(0,i.kt)("img",{src:"/img/backup/rep2.png",width:"100%"})),(0,i.kt)("p",null,"It's also important to ensure you keep regular config backups of the SCALE system itself, preferably right after the Apps backup above).\nHowever this is not part of this guide and we will assume you've done so yourself."),(0,i.kt)("h5",{id:"checking-backups"},"Checking Backups"),(0,i.kt)("p",null,"To make which backups are present, one can use the following command in a shell:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"truetool -l")),(0,i.kt)("h2",{id:"restore"},"Restore"),(0,i.kt)("p",null,"One of the most important parts of backups is to ensure they can be restored.\nThere are two scenario's for a restore:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Reverting a working system")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Total System Restore"))),(0,i.kt)("h5",{id:"reverting-a-running-system"},"Reverting a running system"),(0,i.kt)("p",null,"Reverting a running system is rather trivial. But there are a few caveats:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"This will reinitialize the kubernetes node, which means all kubernetes objects that are not deployed using the Apps system will get reverted"),(0,i.kt)("li",{parentName:"ul"},"You CANNOT revert a single Apps")),(0,i.kt)("p",null,"To revert an existing system, the process is as follows:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"List your current backups using ",(0,i.kt)("inlineCode",{parentName:"p"},"truetool -l"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Pick a backup to revert and note it's name")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Run: ",(0,i.kt)("inlineCode",{parentName:"p"},"truetool -r BACKUPNAME")," (where you replace BACKUPNAME with the name of the backup you selected above)"))),(0,i.kt)("p",null,"Please keep in mind this can take a LONG time."),(0,i.kt)("h5",{id:"total-system-restore"},"Total System restore"),(0,i.kt)("p",null,"Sometimes you either need to wipe your Pool, Migrate to a new Pool or restore a system completely.\nWith the above steps this is all very-much-possible."),(0,i.kt)("ol",{start:0},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Do not initiate the (select a pool for) Apps system yet.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Optional: When the SCALE system itself is also wiped, ensure to restore it using a SCALE config export ",(0,i.kt)("strong",{parentName:"p"},"first"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Using ZFS replication, move back the previously backed-up ",(0,i.kt)("inlineCode",{parentName:"p"},"ix-applications")," dataset.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Continue with the steps listed on ",(0,i.kt)("inlineCode",{parentName:"p"},"Reverting a running system")))),(0,i.kt)("h4",{id:"video-guide"},"Video Guide"),(0,i.kt)("p",null,"TBD"),(0,i.kt)("h5",{id:"additional-documentation"},"Additional Documentation"))}d.isMDXComponent=!0}}]);